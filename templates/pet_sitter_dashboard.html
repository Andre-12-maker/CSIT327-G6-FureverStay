{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Pet Sitter Dashboard | FureverStay</title>
    <link rel="icon" type="image/png" href="{% static 'assets/icon.png' %}">
    <link rel="stylesheet" href="{% static 'css/pet_sitter_dashboard.css' %}">
</head>
<body>
  {% include 'navbar_sitter.html' %}

  <main class="dashboard">
    <!-- üìÖ Calendar Section -->
    <section class="calendar-card">
        <div class="calendar-tabs">
            <button class="tab-btn active" data-tab="calendar">Calendar</button>
            <button class="tab-btn" data-tab="scheduleTab">Schedule</button>
        </div>

        <div class="calendar-content tab-content" id="calendar">
            <div class="calendar-container">
                <div class="calendar-header">
                <button id="prevMonth">‚óÄ</button>
                <h3 id="monthYear"></h3>
                <button id="nextMonth">‚ñ∂</button>
                </div>

                <table class="calendar" id="availabilityCalendar">
                <thead>
                    <tr>
                    <th>Su</th><th>Mo</th><th>Tu</th><th>We</th><th>Th</th><th>Fr</th><th>Sa</th>
                    </tr>
                </thead>
                <tbody id="calendarBody"></tbody>
                </table>

                <p id="availabilityMessage" class="reservations-info">
                 Click a date to toggle ‚ÄúAvailable‚Äù / ‚ÄúBlocked‚Äù
                </p>
            </div>
        </div>
        <!-- Schedule Tab (Accepted Bookings) -->
        <div class="schedule-content tab-content hidden" id="scheduleTab">
            <h3>üìÖ Accepted Bookings</h3>

            {% if sitter_reservations %}
                {% for booking in sitter_reservations %}
                    {% if booking.status == "accepted" %}
                    <div class="reservation-card schedule-card">
                        
                        <div class="reservation-info">
                            <h4>{{ booking.owner.first_name }} {{ booking.owner.last_name }}</h4>

                            <p><b>Pets:</b>
                                {% for pet in booking.pets.all %}
                                {{ pet.pet_name }}{% if not forloop.last %}, {% endif %}
                                {% endfor %}
                            </p>

                            <p><b>Dates:</b> {{ booking.start_date }} ‚Üí {{ booking.end_date }}</p>
                            <p><b>Total Price:</b> ‚Ç±{{ booking.total_price }}</p>
                            <p><b>Status:</b> <span class="status accepted">Accepted</span></p>
                        </div>

                        <div class="reservation-actions">
                            <button class="complete-btn" data-id="{{ booking.id }}">
                                ‚úî Mark as Completed
                            </button>
                        </div>

                    </div>
                    {% endif %}
                {% endfor %}
            {% else %}
                <p>No accepted bookings yet.</p>
            {% endif %}
        </div>        
    </section>
    <section class="reservations-section">
    <h3>üì¨ Service Requests</h3>

    {% if sitter_reservations %}
      {% for booking in sitter_reservations %}
        {% if booking.status == "pending" %}
        <div class="reservation-card">
          <img src="{% static 'assets/default_profile.png' %}"
              alt="{{ booking.owner.username }}"
              class="owner-photo">

          <div class="reservation-info">
            <h4>{{ booking.owner.first_name }} {{ booking.owner.last_name }}</h4>

            <p><b>Pets:</b>
              {% for pet in booking.pets.all %}
                {{ pet.pet_name }}{% if not forloop.last %}, {% endif %}
              {% endfor %}
            </p>

            <p><b>Dates:</b> {{ booking.start_date }} ‚Üí {{ booking.end_date }}</p>
            <p><b>Hours/day:</b> {{ booking.hours_per_day }}</p>
            <p><b>Total:</b> ‚Ç±{{ booking.total_price }}</p>
            <p><b>Status:</b> 
              <span class="status pending">Pending</span>
            </p>
          </div>

          <div class="reservation-actions">
            <button class="accept-btn" data-id="{{ booking.id }}">‚úÖ Accept</button>
            <button class="decline-btn" data-id="{{ booking.id }}">‚ùå Decline</button>
          </div>
        </div>
        {% endif %}
      {% endfor %}
    {% else %}
      <p>No pending service requests at the moment.</p>
    {% endif %}
  </section>

    <!-- RIGHT COLUMN: Earnings & Messages (kept variables & loops) -->
    <aside class="messages-section card">
      <div class="earnings-card">
        <h4>Earnings</h4>
        <p class="earnings-amount">‚Ç±{{ total_earnings|default:"0.00" }}</p>
        <p class="earnings-label">Total this month</p>
      </div>

      <hr style="margin:1.2rem 0;border:none;border-top:1px solid #eee;">

      <h4>Completed Services</h4>
      {% for booking in sitter_reservations %}
          {% if booking.status == "completed" %}
            <div class="reservation-card">
              <img src="{% static 'assets/default_profile.png' %}"
                  alt="{{ booking.owner.username }}"
                  class="owner-photo">

              <div class="reservation-info">
                <h4>{{ booking.owner.first_name }} {{ booking.owner.last_name }}</h4>

                <p><b>Pets:</b>
                  {% for pet in booking.pets.all %}
                    {{ pet.pet_name }}{% if not forloop.last %}, {% endif %}
                  {% endfor %}
                </p>
                <p>Finished: {{ booking.end_date }}</p>
                <p>‚Ç±{{ booking.total_price }} earned</p>
                <p><b>Status:</b> 
                  <span class="status completed">Completed</span>
                </p>
              </div>
            </div>
          {% endif %}
      {% endfor %}
    </aside>
  </main>

  <!-- keep your JS include intact -->
  <script src="{% static 'js/pet_sitter_dashboard.js' %}"></script>

  <!-- keep your csrf form exactly where it was -->
  <form id="csrf-form" style="display:none;">
    {% csrf_token %}
  </form>
</body>
</html>
